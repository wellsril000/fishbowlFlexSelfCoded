# Nixpacks configuration for Railway
# The postal library requires libpostal C library
# Simplified: Let Nixpacks auto-detect Python, then install libpostal in install phase

providers = ["python"]

[phases.setup]
# Minimal packages - let Nixpacks handle Python automatically
nixPkgs = []

[phases.install]
cmds = [
  # Install build dependencies needed for libpostal
  "apt-get update && apt-get install -y pkg-config autoconf automake libtool curl make gcc gettext git libcurl4-openssl-dev || true",
  # Install libpostal from source (required for postal Python library)
  "git clone https://github.com/openvenues/libpostal.git /tmp/libpostal || true",
  "cd /tmp/libpostal && ./bootstrap.sh && ./configure --datadir=/usr/share/libpostal && make -j4 && make install && ldconfig || echo 'libpostal build failed, continuing...'",
  "pip install --upgrade pip",
  "pip install -r requirements.txt"
]

[start]
cmd = "uvicorn main:app --host 0.0.0.0 --port $PORT"


